#Note:
-- may need to add drop all table statements for later use with data
--syntax/integrity of all tables not checked - need to check
--any suggestions/things missing?


#user account table
CREATE TABLE users (
    user_id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,			/*unique user ID*/
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
	user_type VARCHAR(50) DEFAULT 'general_public', 	/*VALUES: general_public, business, health_staff, organisations. */
	fname VARCHAR(250) NOT NULL DEFAULT 'N/A', 		/*N/A as default when organisation or business*/
	lname VARCHAR(250) NOT NULL DEFAULT 'N/A', 		/*N/A as default when organisation or business*/
	organisation_name VARCHAR(250) DEFAULT 'N/A',	/*Only to be used for buisness/organisation, N/A as default when NOT an organisation or business*/
	email VARCHAR(250) NOT NULL,
	address VARCHAR(600) NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
--what other user info do we need?
--maybe change N/A to nothing so it shows as null in the database?



#table for all vaccinated users
CREATE TABLE vaccinated_people (
    user_id INT NOT NULL PRIMARY KEY,		/*unique user ID*/
	vaccinated BOOLEAN NOT NULL,							/*is the user vaccinated?*/
    vaccination_time DATETIME DEFAULT CURRENT_TIMESTAMP,	/*date/time user vaccinated - change to just date?*/
	vaccinated_by VARCHAR(600) NOT NULL, 					/*who vaccianted the user- health organisation or staff*/
	CONSTRAINT user_id_fk FOREIGN KEY (user_id) REFERENCES users (user_id),		/*field has to exist in users table*/
	CONSTRAINT vaccinated_by_fk2 FOREIGN KEY (vaccinated_by) REFERENCES businesses (business_name)		/*field has to exist in business table*/
);
--check bool is default when adding test data
--add field called vaccination status? Completed, scheduled etc?


#table for businesses & health organisations as they are basically the same
CREATE TABLE businesses (
    business_name VARCHAR(600) NOT NULL,		
	address VARCHAR(600) NOT NULL,
	PRIMARY KEY( business_name, address)
);



#table for check-in logs
CREATE TABLE check-Ins (
	user_id INT NOT NULL PRIMARY KEY,		/*unique user ID*/
    business_name VARCHAR(600) NOT NULL PRIMARY KEY,		
	address VARCHAR(600) NOT NULL,	
	check_in_time DATETIME DEFAULT CURRENT_TIMESTAMP,	/*Current time used to sign in*/
	check_out_time DATETIME,							/*Time signed out*/
	PRIMARY KEY( business_name, address),
	CONSTRAINT address_fk FOREIGN KEY (address) REFERENCES businesses (address), 		/*field has to exist in business table*/
	CONSTRAINT business_name_fk2 FOREIGN KEY (business_name) REFERENCES businesses (business_name)		/*field has to exist in business table*/
);
#decide how to do check-out time?

# ---================================Load Data into table ======================================================---
# --=-=-=-=-=-=-=- user accounts -=-=-=-=-=--
# Dummy user account for testing
INSERT INTO users2(user_id, username, password, user_type, fname, lname, organisation_name, email, address, created_at)
VALUES(NULL,'test', 'test', DEFAULT, 'John', 'Smith', DEFAULT, 'test@gmail.com', '10 Garb St', DEFAULT);

#general public 
INSERT INTO users2(user_id, username, password, user_type, fname, lname, organisation_name, email, address, created_at)
VALUES(NULL,'general_public', 'general_public', DEFAULT, 'Jeff', 'Jones', DEFAULT, 'Jeff@gmail.com', '20 Blue St', DEFAULT);

#buisness account
INSERT INTO users2(user_id, username, password, user_type, fname, lname, organisation_name, email, address, created_at)
VALUES(NULL,'business', 'business', 'business', 'Amy', 'Pond', DEFAULT, 'Amy@gmail.com', '30 Yellow St', DEFAULT);

#health_staff
INSERT INTO users2(user_id, username, password, user_type, fname, lname, organisation_name, email, address, created_at)
VALUES(NULL,'health_staff', 'health_staff', 'health_staff', 'Dr.', 'Who', 'Hospital Org', 'Dr@gmail.com', '40 Purple St', DEFAULT);

#organisation
INSERT INTO users2(user_id, username, password, user_type, fname, lname, organisation_name, email, address, created_at)
VALUES(NULL,'organisation', 'organisation', 'organisation', 'Rory', 'Williams', 'Roman Cor', 'rory@gmail.com', '50 Gold St', DEFAULT);



